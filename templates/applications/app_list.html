{% extends "base.html" %}

{% block content %}
  <p><a href="{% url 'applications:create' %}">+ New Application</a></p>

  <form method="get">
    <input type="text" name="q" placeholder="Search company or role..." value="{{ q }}">
    {% if status %}
      <input type="hidden" name="status" value="{{ status }}">
    {% endif %}
    <button type="submit">Search</button>
    <a href="{% url 'applications:list' %}">Reset</a>
  </form>

  <hr>

  <nav>
    <a href="{% url 'applications:list' %}?q={{ q }}"
      {% if not status %}style="font-weight:bold; text-decoration: underline;"{% endif %}>
      All
    </a>

    {% for value, label, count in status_count_list %}
      | <a href="{% url 'applications:list' %}?status={{ value }}&q={{ q }}"
          {% if status == value %}style="font-weight:bold; text-decoration: underline;"{% endif %}>
          {{ label }} ({{ count }})
        </a>
    {% endfor %}
  </nav>

  <hr>

  {% if applications %}
    <ul>
      {% for app in applications %}
        <li>
          <strong>{{ app.company }}</strong> â€” {{ app.role_title }}
          ({{ app.get_status_display }})
          <a href="{% url 'applications:update' app.pk %}">Edit</a>
          <a href="{% url 'applications:delete' app.pk %}">Delete</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No applications yet. Add one!</p>
  {% endif %}

  {% if page_obj.has_other_pages %}
    <nav>
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&status={{ status }}">Previous</a>
      {% endif %}

      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&status={{ status }}">Next</a>
      {% endif %}
    </nav>
  {% endif %}
{% endblock %}
